// This is your Prisma schema file
generator client {
  provider = "prisma-client-js"
}

// 数据库配置（PostgreSQL，若用 MySQL 替换为 provider = "mysql"）
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// 新增：举报状态枚举（解决 ReportStatus 导出错误）
enum ReportStatus {
  PENDING    // 待处理
  APPROVED   // 已批准
  REJECTED   // 已驳回
  RESOLVED   // 已解决
}

// 新增：验证状态枚举（解决 VerificationStatus 导出错误）
enum VerificationStatus {
  PENDING    // 待验证
  VERIFIED   // 已验证
  REJECTED   // 已拒绝
  EXPIRED    // 已过期
}

// 新增：验证类型枚举（解决 VerificationType 导出错误）
enum VerificationType {
  EMAIL      // 邮箱验证
  PHONE      // 手机验证
  IDENTITY   // 身份验证
  FACE       // 人脸验证
}

// 用户核心模型
model User {
  id              String               @id @default(cuid())
  email           String               @unique
  name            String?
  password        String?              // 密码（建议加密存储）
  country         String?              // 对应 auth.service.ts 中的 country 字段
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt
  // 关联模型
  traces          Trace[]
  rooms           Room[]
  verifications   Verification[]
  reports         Report[]
}

// 轨迹模型（原有的核心业务模型）
model Trace {
  id        String   @id @default(cuid())
  content   String                        // 轨迹内容
  imageUrl  String?                       // 图片URL
  width     Int?                          // 图片宽度
  height    Int?                          // 图片高度
  userId    String                        // 关联用户ID
  user      User     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// 房间模型（原有的核心业务模型）
model Room {
  id        String   @id @default(cuid())
  name      String                        // 房间名称
  isActive  Boolean  @default(false)      // 是否活跃
  userId    String                        // 关联用户ID
  user      User     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// 新增：验证模型（生成 VerificationWhereInput 等类型）
model Verification {
  id              String               @id @default(cuid())
  userId          String
  type            VerificationType     // 验证类型
  status          VerificationStatus   // 验证状态
  verifyCode      String?              // 验证码（可选）
  expiredAt       DateTime?            // 过期时间
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt
  // 关联用户
  user            User                 @relation(fields: [userId], references: [id])
}

// 新增：举报模型（生成 Report 类型）
model Report {
  id              String               @id @default(cuid())
  userId          String               // 举报人ID
  targetId        String               // 被举报对象ID（轨迹/房间/用户ID）
  targetType      String               // 被举报类型（trace/room/user）
  status          ReportStatus         // 举报状态
  content         String               // 举报内容
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt
  // 关联用户
  user            User                 @relation(fields: [userId], references: [id])
}

// 新增：审计日志模型（解决 audit.service.ts 中的 JsonValue 类型问题）
model AuditLog {
  id              String               @id @default(cuid())
  userId          String?              // 操作人ID
  action          String               // 操作类型（login/create/update/delete）
  resourceType    String               // 操作资源类型
  resourceId      String               // 操作资源ID
  metadata        Json?                // 操作元数据（对应 JsonValue 类型）
  ip              String?              // 操作IP
  createdAt       DateTime             @default(now())
  // 关联用户
  user            User?                @relation(fields: [userId], references: [id])
}